# Змейка с ИИ (Snake Game with AI)

## Обзор проекта
Игра Змейка на Python с использованием pygame и интегрированным ИИ для обучения методом генетического алгоритма.

## Недавние изменения
- 20 октября 2025 (вечер): Масштабная модернизация архитектуры ИИ
  - **РАЗМЕР КАРТЫ:** Зафиксирован на 30x30 (900 клеток) для всех режимов
  - **НОВАЯ АРХИТЕКТУРА ИИ:** Агрессивная архитектура [8 → 1024 → 1536 → 1024 → 512 → 4]
    - Входные данные: 8 нейронов (координаты, расстояния)
    - Скрытые слои: [1024, 1536, 1024, 512] - 4 мощных слоя
    - Выход: 4 направления
    - Всего параметров: ~3.8 миллиона
  - **GUI:** Автоматическое масштабирование под размер монитора (70%)
  - **Популяция:** Увеличена до 200 особей (вместо 50)
  - **Мутации:** Оптимизированы (rate=0.1, strength=0.25)
  - **Elite count:** 20 лучших особей сохраняются
  - **Fitness функция:** score × 1000 + length × 10 + steps × 0.1
  - **Max steps:** Увеличено до 5000 для сложных стратегий

- 20 октября 2025 (утро): Настройка для работы в Replit
  - Настроена среда Python 3.11
  - Установлены зависимости через uv (numpy, pygame)
  - Создан .gitignore для Python проектов
  - Настроен workflow для запуска через VNC (графический интерфейс)
  - Проект полностью готов к использованию в Replit

- 19 октября 2025: Полная интеграция ИИ + GUI тренер
  - Установлены Python 3.11, pygame и numpy
  - Реализована игровая логика в `src/game_logic.py`
  - Создана нейронная сеть в `src/ai/neural_network.py`
  - Реализован генетический алгоритм в `src/ai/genetic_algorithm.py`
  - Создан AI Player в `src/ai/ai_player.py`
  - Добавлен интерактивный выбор режима в `main.py`
  - Создан скрипт обучения `train_ai.py`
  - **ДОБАВЛЕН ГРАФИЧЕСКИЙ ТРЕНЕР** `ai_trainer_gui.py` с:
    - Визуализацией обучения в реальном времени
    - Панелью управления (Старт/Пауза/Стоп/Сохранить)
    - Списком всех особей с их статистикой
    - Графиками прогресса по поколениям
    - Возможностью просмотра любой особи
    - Настройками параметров обучения

## Архитектура проекта

### Структура файлов
```
.
├── src/
│   ├── game_logic.py           # Чистая игровая логика
│   └── ai/
│       ├── neural_network.py   # Нейронная сеть
│       ├── ai_player.py        # ИИ игрок
│       └── genetic_algorithm.py # Генетический алгоритм
├── main.py                      # Главный файл с меню и игрой
├── train_ai.py                  # Скрипт консольного обучения ИИ
├── ai_trainer_gui.py            # Графический тренер ИИ
├── .gitignore                   # Игнорируемые файлы
├── README.md                    # Документация
└── replit.md                    # Этот файл
```

### Ключевые компоненты

#### src/game_logic.py
- **Класс SnakeGame**: Основная игровая логика
  - Поддержка произвольного размера поля (NxM)
  - Метод `get_state_for_ai()` возвращает данные для ИИ:
    - Позиция головы змеи (x, y)
    - Размерность поля (width, height)
    - Координаты яблока (x, y)
    - Начальная и текущая длина змеи
    - Счёт и статус игры

#### src/ai/neural_network.py
- **Класс NeuralNetwork**: Fully-connected нейронная сеть с глубокой архитектурой
  - Вход: 8 нейронов (позиции головы, яблока, расстояние, длина)
  - Скрытые слои: **[1024, 1536, 1024, 512]** - агрессивная архитектура для карты 30x30
  - Выход: 4 нейрона (UP, DOWN, LEFT, RIGHT)
  - Всего параметров: ~3.8 миллиона
  - Функции активации: ReLU + Softmax
  - Методы для мутации и кроссовера

#### src/ai/ai_player.py
- **Класс AIPlayer**: Игрок, управляемый нейросетью
  - Преобразует состояние игры в нормализованные входные данные
  - Принимает решения через нейронную сеть
  - Входные данные (8 параметров):
    1. Нормализованная позиция головы X
    2. Нормализованная позиция головы Y
    3. Нормализованная позиция яблока X
    4. Нормализованная позиция яблока Y
    5. Относительное расстояние по X
    6. Относительное расстояние по Y
    7. Евклидово расстояние до яблока
    8. Относительная длина змеи

#### src/ai/genetic_algorithm.py
- **Класс GeneticAlgorithm**: Обучение поколениями
  - Размер популяции: 200 особей (оптимизировано для большой сети)
  - Элитизм: 20 лучших особей сохраняются
  - Турнирная селекция
  - Кроссовер и мутация весов (rate=0.1, strength=0.25)
  - Fitness функция: счёт × 1000 + длина × 10 + шаги × 0.1
  - Max steps: 5000 (для сложных стратегий)
  - Сохранение/загрузка весов

#### main.py
- **Интерактивное меню**: Выбор режима игры
  - Играть человеком
  - Смотреть ИИ (авто-загрузка обученной модели)
  - Обучить ИИ (GUI) - **графический тренер**
  - Обучить ИИ (консоль) - информация о train_ai.py
- **Класс SnakeGameGUI**: Визуализация игры
  - Поддержка режимов человек/ИИ
  - Различная цветовая схема для режимов
  - Фиксированный размер поля 30x30

#### ai_trainer_gui.py
- **Класс AITrainerGUI**: Графический интерфейс для обучения
  - **Автомасштабирование**: окно занимает 70% экрана, адаптивная сетка
  - **Визуализация**: игровое поле 30x30 с лучшей особью в реальном времени
  - **Панель управления**: кнопки Старт/Пауза/Стоп/Сохранить
  - **Список особей**: все особи поколения с fitness и счётом
  - **Кнопка "Просмотр"**: показать игру любой особи
  - **Графики**: прогресс обучения (лучший/средний счёт)
  - **Настройки**: размер популяции (200), скорость визуализации
  - **Прокрутка**: скролл списка особей мышью
  - **Многопоточность**: обучение в фоне, GUI не зависает

#### train_ai.py
- Скрипт для обучения ИИ через командную строку
- Параметры через argparse:
  - `--generations`: количество поколений
  - `--population`: размер популяции
  - `--width/--height`: размер поля
  - `--save-interval`: интервал сохранения
- Автоматическое сохранение лучшего ИИ
- Поддержка прерывания (Ctrl+C)

## Текущее состояние
Игра полностью функциональна с интегрированным ИИ. Можно играть человеком или наблюдать за игрой ИИ. Обучение через генетический алгоритм готово к запуску.

## Запуск в Replit
В Replit игра автоматически запускается через VNC (виртуальный графический интерфейс). Просто нажмите кнопку "Run" или перезапустите workflow "Snake Game". Графическое окно pygame откроется в панели VNC справа.

## Запуск проекта

### Играть или смотреть ИИ
```bash
python main.py
```
Выберите режим в меню:
- **Играть человеком**: стрелки/WASD для управления
- **Смотреть ИИ**: автоматически загружает обученного ИИ из `best_ai.npy` (если существует), иначе показывает случайного ИИ
- **Обучить ИИ (GUI)**: ⭐ **РЕКОМЕНДУЕТСЯ** - графический интерфейс с визуализацией
- **Обучить ИИ (консоль)**: информация о консольном обучении через train_ai.py

### Обучить ИИ через GUI (рекомендуется)
```bash
python main.py
```
Выберите "Обучить ИИ (GUI)" в меню. Все функции доступны через кнопки:
1. **Старт** - начать обучение
2. **Пауза** - приостановить/продолжить
3. **Стоп** - остановить обучение
4. **Сохранить** - сохранить лучшую модель
5. **Просмотр** - кликните на любой особи для просмотра её игры
6. **+/-** - изменить параметры (популяция, скорость)

Или запустить напрямую:
```bash
python ai_trainer_gui.py
```

### Обучить ИИ через консоль (для продвинутых)
```bash
python train_ai.py --generations 100 --population 100 --width 15 --height 15
```

### Управление в игре
- **Стрелки** или **WASD** - движение (только в режиме игрока)
- **ПРОБЕЛ** - перезапуск игры
- **ESC** - выход

## Архитектура ИИ

### Почему ограниченные входные данные?
Поле может быть размером до 100×100 = 10000 клеток. Передавать всё поле нереалистично. Вместо этого ИИ получает только ключевые координаты и должен моделировать игру в своей памяти.

### Почему генетический алгоритм?
Из-за высокого порога входа (ИИ должен научиться моделировать состояние игры) случайная инициализация одной сети не работает. Генетический алгоритм позволяет постепенно эволюционировать популяцию к лучшим решениям.

### Fitness функция
```
fitness = score × 1000 + length × 10 + steps × 0.1
```
- Главное - счёт (собранные яблоки)
- Длина змеи поощряется
- Время жизни учитывается минимально

## Предпочтения пользователя
- Язык: Python
- Чистая архитектура с разделением логики и визуализации
- Подготовка к обучению ИИ поколениями
- Ограниченные входные данные для ИИ
